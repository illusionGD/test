"use strict";var audios,screenW=parseInt(window.getComputedStyle(document.getElementById("game")).width),screenH=document.documentElement.clientHeight,game=new Phaser.Game(screenW,screenH,Phaser.CANVAS,"game"),scaleVal=screenH/400<screenW/240?screenW/240:screenH/400,gameConfig={planeFireDis:500,enemyFireDis:1e3,enemyCreateDis:1e3,enemyMoveSpeed:20,enemyBulletSpeed:30,planeBulletSpeed:200},num=0;game.States={},game.States.boot=function(){this.preload=function(){game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,game.load.image("loading","./assets/plane/preloader.gif")},this.create=function(){game.state.start("preload")}},game.States.preload=function(){this.preload=function(){var e=game.add.sprite(10,game.height/2,"loading");game.load.setPreloadSprite(e),game.load.image("bg","./assets/plane/bg.jpg"),game.load.image("copyright","./assets/plane/copyright.png"),game.load.spritesheet("myplane","./assets/plane/myplane.png",40,40,4),game.load.spritesheet("startbutton","./assets/plane/startbutton.png",100,40,2),game.load.spritesheet("replaybutton","./assets/plane/replaybutton.png",80,30,2),game.load.spritesheet("sharebutton","./assets/plane/sharebutton.png",80,30,2),game.load.image("mybullet","./assets/plane/mybullet.png"),game.load.image("bullet","./assets/plane/bullet.png"),game.load.image("enemy1","./assets/plane/enemy1.png"),game.load.image("enemy2","./assets/plane/enemy2.png"),game.load.image("enemy3","./assets/plane/enemy3.png"),game.load.spritesheet("explode1","./assets/plane/explode1.png",20,20,3),game.load.spritesheet("explode2","./assets/plane/explode2.png",30,30,3),game.load.spritesheet("explode3","./assets/plane/explode3.png",50,50,3),game.load.spritesheet("myexplode","./assets/plane/myexplode.png",40,40,3),game.load.image("award","./assets/plane/award.png"),game.load.audio("normalback","./assets/plane/normalback.mp3"),game.load.audio("playback","./assets/plane/playback.mp3"),game.load.audio("fashe","./assets/plane/fashe.mp3"),game.load.audio("crash1","./assets/plane/crash1.mp3"),game.load.audio("crash2","./assets/plane/crash2.mp3"),game.load.audio("crash3","./assets/plane/crash3.mp3"),game.load.audio("ao","./assets/plane/ao.mp3"),game.load.audio("pi","./assets/plane/pi.mp3"),game.load.audio("deng","./assets/plane/deng.mp3")},this.create=function(){game.state.start("start")}},game.States.start=function(){var a;this.create=function(){game.add.image(0,0,"bg").scale.set(scaleVal,scaleVal),game.add.image(game.world.centerX,game.world.height-10,"copyright").anchor.set(.5,.5);var e=game.add.sprite(game.world.centerX,game.world.centerY,"myplane");e.anchor.set(.5,.5),e.animations.add("fly"),e.animations.play("fly",15,!0),game.add.button(game.world.centerX,game.world.height/2+50,"startbutton",this.onStartClick,this,1,0,1,0).anchor.set(.5,.5),(a=game.add.audio("normalback",.2,!0)).play()},this.onStartClick=function(){game.state.start("play"),a.destroy()}},game.States.end=function(){this.create=function(){game.add.image(0,0,"bg").scale.set(scaleVal,scaleVal);var e=game.add.text(game.world.centerX,game.world.centerY,"Score: ".concat(num),{font:"20px",fill:"red"}),a=game.add.button(game.world.centerX,game.world.centerY+50,"replaybutton",function(){game.state.start("play")},this,1,0,1,0);e.anchor.set(.5,.5),a.anchor.set(.5,.5)}},game.States.play=function(){var n,s,l,o,d,i,a,m,r,g=(new Date).getTime(),p=(new Date).getTime(),c=(new Date).getTime(),y=(new Date).getTime(),u=0;function e(e,a){e.kill(),t()}function h(e,a){r.play(),e.kill(),t()}function f(e,a){r.play(),e.kill(),a.kill();var t=i.getFirstExists(!1);t?t.reset(e.x,e.y):(t=game.add.sprite(e.x,e.y,"explode"+e.type),i.add(t)),t.animations.add("boom").play(10,!1,!0),s.text="Score: ".concat(num+=10,"   LEVEL: ").concat(u)}function t(){var e=game.add.sprite(n.x,n.y,"myexplode").animations.add("boom");e.play(10,!1,!0),e.onComplete.add(function(){n.kill(),a.destroy(),game.state.start("end")})}function b(){n.inputEnabled=!0,n.input.enableDrag(!0),s=game.add.text(0,0,"Score: ".concat(num,"   LEVEL: ").concat(u),{font:"16px",fill:"#000"}),n.isFire=!0,game.physics.enable(n,Phaser.Physics.ARCADE),n.body.colliderWorldBounds=!0,(l=game.add.group()).enableBody=!0}this.create=function(){game.physics.startSystem(Phaser.Physics.ARCADE);var e=game.add.tileSprite(0,0,game.width,game.height,"bg");e.autoScroll(0,20),e.scale.set(scaleVal,scaleVal),(n=game.add.sprite(game.world.centerX,game.world.centerY,"myplane")).anchor.set(.5,.5),n.animations.add("fly"),n.animations.play("fly",15,!0),game.add.tween(n).to({y:game.world.height-20},1e3,Phaser.Easing.Sinusoidal.Out,!0).onComplete.add(b),(a=game.add.audio("playback",.2,!0)).play(),m=game.add.audio("pi",3,!1),r=game.add.audio("crash1",3,!1),o=game.add.group(),d=game.add.group(),i=game.add.group(),o.enableBody=!0,d.enableBody=!0,i.enableBody=!0},this.update=function(){var t;y=(new Date).getTime(),u=num/10,function(){var e=y-p;if(!n.isFire||e<=gameConfig.enemyCreateDis)return;var a=o.getFirstExists(!1);{var t;a?a.reset(Math.random()*game.world.width,0):(t=Math.ceil(2*Math.random()+1),(a=o.create(Math.random()*game.world.width,-50,"enemy"+t)).type=t)}a.anchor.set(.5,.5),a.body.velocity.y=gameConfig.enemyMoveSpeed,a.checkWorldBounds=!0,a.outOfBoundsKill=!0,a.fireSpeed=gameConfig.enemyBulletSpeed+20*a.type,p=(new Date).getTime()}(),t=y-c,o.forEachAlive(function(e){var a;t>gameConfig.enemyFireDis&&((a=d.getFirstExists(!1))?a.reset(e.x,e.y):a=d.create(e.x,e.y,"bullet"),a.body.velocity.y=e.fireSpeed,a.checkWorldBounds=!0,a.outOfBoundsKill=!0,c=(new Date).getTime())}),function(){var e=y-g;if(!n.isFire||e<=gameConfig.planeFireDis)return;m.play();var a=l.getFirstExists(!1);a?a.reset(n.x,n.y):a=l.create(n.x,n.y,"mybullet");{var t;1<=u&&((t=l.getFirstExists(!1))?t.reset(n.x,n.y):t=l.create(n.x,n.y,"mybullet"),t.body.velocity.y=-gameConfig.planeBulletSpeed,t.body.velocity.x=-20)}{var s;5<=u&&((s=l.getFirstExists(!1))?s.reset(n.x,n.y):s=l.create(n.x,n.y,"mybullet"),s.body.velocity.y=-gameConfig.planeBulletSpeed,s.body.velocity.x=20)}a.checkWorldBounds=!0,a.outOfBoundsKill=!0,a.body.velocity.y=-gameConfig.planeBulletSpeed,g=(new Date).getTime()}(),game.physics.arcade.overlap(o,l,f),game.physics.arcade.overlap(o,n,h),game.physics.arcade.overlap(d,n,e)}},game.state.add("boot",game.States.boot),game.state.add("preload",game.States.preload),game.state.add("start",game.States.start),game.state.add("play",game.States.play),game.state.add("end",game.States.end),game.state.start("boot");