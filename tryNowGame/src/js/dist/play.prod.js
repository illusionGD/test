"use strict";var gamePlayState=function(){var n,i,r,o,s,c,l,d=30,p=!1,t=0,e=!1,a=[],u=[3,3,3],m=!1,y=2*rem2px(19.2);function f(e,t){t.kill(),h(e)}function g(e,t){t.isDead||t.isJury||(n.injury(),h(t))}function h(e){m||(s.play("",.1),m=!0),--e.life,0<e.life?e.inJuryTween.start():e.isDead||e.isJury||(e.DeadTween.start(),t+=1,a.length<3&&t>=u[a.length]&&(t=0,k(),document.querySelector(".skill-audio").play(),document.querySelector(".skill-pop").style.display="flex"))}function v(){var e=10<=d-1?--d:"0"+--d;if(i.text="00:".concat(e),d<=0)return game.time.events.remove(r),void(p=!0);d<=30&&d%5==0&&trackGA("坚持到".concat(d,"秒"),"存活");var t,a;game.time.totalElapsedSeconds().toFixed(0);20===d&&(t=getConfig("enemyConfig2"),c.config.createNum=t.createNum,c.config.moveSpeed=t.moveSpeed,c.config.createDis=t.createDis,c.config.life=t.life),10===d&&(a=getConfig("enemyConfig3"),c.config.createNum=a.createNum,c.config.moveSpeed=a.moveSpeed,c.config.createDis=a.createDis,c.config.life=a.life)}function k(){n.stop(),c.stop(),r.timer.paused=!0,e=!0}function S(e){return a.includes(e)}function x(){document.querySelector(".pop").style.display="none",n.start(),c.start(),r.timer.paused=!1,e=!1}this.create=function(){var e=getConfig("baseConfig");d=e.timeCount,u=[e.point0,e.point1,e.point2];var t=game.add.tileSprite(0,0,y,y,keyMap.startBgImg);game.physics.startSystem(Phaser.Physics.ARCADE),(l=game.add.audio(keyMap.audioBg,1,!0)).play(),(s=game.add.audio(keyMap.audioHit,.5)).onStop.add(function(){m=!1},this),n=new Player(t.width/2,t.height/2),game.camera.follow(n.player),game.world.setBounds(0,0,y,y),(c=new EnemyFactory).init(),(o=game.add.image(0,0,keyMap.topTimeBg)).fixedToCamera=!0;var a=scaleAdaptation(750);o.scale.set(a,a),r=game.time.events.repeat(+Phaser.Timer.SECOND,d+1,v,this),(i=game.add.text(game.camera.width/2,rem2px(1.05),"00:".concat(d),{font:"bold ".concat(rem2px(.4),"px Arial"),fill:"#fff"})).stroke="#000",i.strokeThickness=5,i.fixedToCamera=!0,i.anchor.set(.5,.5)},this.update=function(){var a,i;e||(p||n.life<=0?function(){0<n.life?(game.add.audio(keyMap.audioSuccess,1).play(),trackGA("坚持到0秒","在线")):(game.add.audio(keyMap.audioFail,1).play(),trackGA("血量归0","断线"));p=!0,k(),document.querySelector(".award-pop").style.display="block",l.stop()}():(n.run(),a=null,i=game.camera.width,c.enemyGroup.forEachAlive(function(e){var t;e.isDead||(t=game.physics.arcade.distanceToPointer(n.player,e.pointer))<i&&(i=t,a=e)}),n.fire(a),n.fireKnife(),n.petFire(),c.move(n.player.x,n.player.y),n.axRotate(),c.createEnemy(n.player.x,n.player.y),game.physics.arcade.overlap(c.enemyGroup,n.bullets,f,null,this),game.physics.arcade.overlap(c.enemyGroup,n.player,g,null,this),game.physics.arcade.overlap(c.enemyGroup,n.pet.fireGroup,h,null,this),game.physics.arcade.overlap(c.enemyGroup,n.KnifeGroup,h,null,this),game.physics.arcade.overlap(c.enemyGroup,n.ax,function(e,t){h(t)},null,this)))},this.render=function(){},document.querySelector(".btn-skill1").addEventListener("click",function(e){S("1")||(a.push("1"),e.target.classList.add("btn-skill-gray"),n.stopAx=!1,n.axLastTime=(new Date).getTime(),x())}),document.querySelector(".btn-skill2").addEventListener("click",function(e){S("2")||(a.push("2"),e.target.classList.add("btn-skill-gray"),n.stopKnife=!1,x())}),document.querySelector(".btn-skill3").addEventListener("click",function(e){S("3")||(a.push("3"),e.target.classList.add("btn-skill-gray"),n.pet.visible=!0,n.stopPetFire=!1,x())}),document.querySelector(".btn-reward").addEventListener("click",function(e){trackGA("按钮的点击次数","点击"),e.stopPropagation()})};