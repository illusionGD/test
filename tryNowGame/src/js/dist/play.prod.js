"use strict";var gamePlayState=function(){var n,i,r,a,o,s,c,l=30,d=!1,t=0,e=!1,p=[],u=[3,3,3],m=!1,f=2*rem2px(19.2);function y(e,t){t.kill(),h(e)}function g(e,t){t.isDead||t.isJury||(n.injury(),h(t))}function h(e){m||(o.play(),m=!0),--e.life,0<e.life?e.inJuryTween.start():e.isDead||e.isJury||(e.DeadTween.start(),t+=1,p.length<3&&t>=u[p.length]&&(t=0,k(),document.querySelector(".skill-pop").style.display="flex"))}function v(){var e=10<=l-1?--l:"0"+--l;if(i.text="00:".concat(e),l<=0)return game.time.events.remove(r),void(d=!0);l%5==0&&trackGA("坚持到".concat(l,"秒"),"存活");var t,a;game.time.totalElapsedSeconds().toFixed(0);20===l&&(t=getConfig("enemyConfig2"),s.config.createNum=t.createNum,s.config.moveSpeed=t.moveSpeed,s.config.createDis=t.createDis,s.config.life=t.life),10===l&&(a=getConfig("enemyConfig3"),s.config.createNum=a.createNum,s.config.moveSpeed=a.moveSpeed,s.config.createDis=a.createDis,s.config.life=a.life)}function k(){n.stop(),s.stop(),r.timer.paused=!0,e=!0}function S(e){return p.includes(e)}function b(){document.querySelector(".pop").style.display="none",n.start(),s.start(),r.timer.paused=!1,e=!1}this.create=function(){var e=getConfig("baseConfig");l=e.timeCount,u=[e.point0,e.point1,e.point2],game.add.tileSprite(0,0,f,f,keyMap.startBgImg),game.physics.startSystem(Phaser.Physics.ARCADE),(c=game.add.audio(keyMap.audioBg,1,!0)).play(),(o=game.add.audio(keyMap.audioHit,.5)).onStop.add(function(){m=!1},this),n=new Player,game.camera.follow(n.player),game.world.setBounds(0,0,f,f),(s=new EnemyFactory).init(),(a=game.add.image(0,0,keyMap.topTimeBg)).fixedToCamera=!0;var t=scaleAdaptation(750);a.scale.set(t,t),r=game.time.events.repeat(+Phaser.Timer.SECOND,l+1,v,this),(i=game.add.text(game.camera.width/2,rem2px(1.05),"00:".concat(l),{font:"bold ".concat(rem2px(.4),"px Arial"),fill:"#fff"})).stroke="#000",i.strokeThickness=5,i.fixedToCamera=!0,i.anchor.set(.5,.5)},this.update=function(){var a,i;e||(d||n.life<=0?function(){0<n.life?trackGA("坚持到0秒","在线"):trackGA("血量归0","断线");d=!0,k(),document.querySelector(".award-pop").style.display="block",c.stop()}():(n.run(),a=null,i=game.camera.width,s.enemyGroup.forEachAlive(function(e){var t;e.isDead||(t=game.physics.arcade.distanceToPointer(n.player,e.pointer))<i&&(i=t,a=e)}),n.fire(a),n.fireKnife(),n.petFire(),n.tornadosRotate(),s.move(n.player.x,n.player.y),s.createEnemy(n.player.x,n.player.y),game.physics.arcade.overlap(s.enemyGroup,n.bullets,y,null,this),game.physics.arcade.overlap(s.enemyGroup,n.player,g,null,this),game.physics.arcade.overlap(s.enemyGroup,n.tornados,h,null,this),game.physics.arcade.overlap(s.enemyGroup,n.pet.fireGroup,h,null,this),game.physics.arcade.overlap(s.enemyGroup,n.KnifeGroup,h,null,this)))},this.render=function(){},document.querySelector(".btn-skill1").addEventListener("click",function(e){S("1")||(p.push("1"),e.target.classList.add("btn-skill-gray"),n.addTornadoSkill(),b())}),document.querySelector(".btn-skill2").addEventListener("click",function(e){S("2")||(p.push("2"),e.target.classList.add("btn-skill-gray"),n.stopKnife=!1,b())}),document.querySelector(".btn-skill3").addEventListener("click",function(e){S("3")||(p.push("3"),e.target.classList.add("btn-skill-gray"),n.pet.visible=!0,n.stopPetFire=!1,b())}),document.querySelector(".btn-reward").addEventListener("click",function(e){trackGA("按钮的点击次数","点击"),e.stopPropagation()})};