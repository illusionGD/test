"use strict";function ownKeys(t,e){var i,n=Object.keys(t);return Object.getOwnPropertySymbols&&(i=Object.getOwnPropertySymbols(t),e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,i)),n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(i,!0).forEach(function(e){_defineProperty(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ownKeys(i).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}var EnemyFactory=function(){function t(){_classCallCheck(this,t);var e=getConfig("enemyConfig");this.config=_objectSpread({moveSpeed:100,createDis:800,createNum:1,maxCount:80,life:1,juryTime:500,deadTime:200,createScope:2,deadDis:4},e),this.lasTime=(new Date).getTime(),this.init()}return _createClass(t,[{key:"init",value:function(){this.isDead=!1,this.enemyGroup=game.add.group(),this.enemyGroup.enableBody=!0}},{key:"move",value:function(e,t){var r=this,o=0<arguments.length&&void 0!==e?e:0,a=1<arguments.length&&void 0!==t?t:0;this.enemyGroup.forEachAlive(function(e){var t=computeVector(o,a,e.x,e.y),i=t.x,n=t.y;e.isDead||e.isJury?(e.body.velocity.x=i/2*-r.config.moveSpeed*r.config.deadDis,e.body.velocity.y=0):(e.body.velocity.x=i*r.config.moveSpeed,e.body.velocity.y=n*r.config.moveSpeed,e.isJury||(e.frame=0<i?2:1))})}},{key:"createEnemy",value:function(e,t){var n=this;if((new Date).getTime()-this.lasTime>this.config.createDis&&this.config.maxCount>this.enemyGroup.total){for(var r=e+rem2px(this.config.createScope),o=e-rem2px(this.config.createScope),a=t+rem2px(this.config.createScope),c=t-rem2px(this.config.createScope),i=0;i<this.config.createNum;i++)!function(){var e=game.camera.position.x-game.camera.width/2+Math.random()*game.camera.width,t=game.camera.position.y-game.camera.height/2+Math.random()*game.camera.height,i=n.enemyGroup.getFirstExists(!1);e<r&&o<e&&(e=r),t<a&&c<t&&(t=c),i||((i=n.enemyGroup.create(e,t,keyMap.enemy)).scale.set(.6,.6),i.anchor.set(.5,1),i.body.setSize(i.width,i.height),i.shakeTween=game.add.tween(i).to({rotation:.5},500,Phaser.Easing.Cubic.In,!0,0,-1,!0),i.inJuryNum=game.add.text(0,0,"-100",{font:"bold ".concat(rem2px(.3),"px Arial"),fill:"#fff"}),i.inJuryNum.stroke="#000000",i.inJuryNum.strokeThickness=rem2px(.05),i.inJuryNum.visible=!1,i.inJuryNumMove=rem2px(.02),i.DeadTween=game.add.tween(i).to({},n.config.deadTime,Phaser.Easing.Cubic.In,!1),i.DeadTween.onComplete.add(function(){i.inJuryNum.visible=!1,i.kill()}),i.DeadTween.onStart.add(function(){i.inJuryNum.visible=!0,i.inJuryNum.x=i.x,i.inJuryNum.y=i.y,i.isDead=!0,i.tint=16777215,i.frame=1===i.frame?0:3}),i.inJuryTween=game.add.tween(i).to({},n.config.juryTime,Phaser.Easing.Cubic.In,!1),i.inJuryTween.onComplete.add(function(){i.inJuryNum.visible=!1,i.isJury=!1,i.tint=16777215}),i.inJuryTween.onStart.add(function(){i.inJuryNum.visible=!0,i.inJuryNum.x=i.x,i.inJuryNum.y=i.y,i.isJury=!0,i.frame=1===i.frame?0:3}),i.body.collideWorldBounds=!0),i.life=n.config.life,n.resetEnemy(i,e,t)}();this.lasTime=(new Date).getTime()}}},{key:"resetEnemy",value:function(e,t,i){e.isDead=!1,e.isJury=!1,e.frame=1,e.tint=16777215,e.reset(t,i)}},{key:"stop",value:function(){this.enemyGroup.forEachAlive(function(e){e.body.velocity.set(0),e.shakeTween.pause()})}},{key:"start",value:function(){this.enemyGroup.forEachAlive(function(e){e.shakeTween.start()})}}]),t}();