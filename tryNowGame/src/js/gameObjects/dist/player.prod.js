"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}var Player=function(){function e(){_classCallCheck(this,e),this.config={moveSpeed:200,bulletDis:500,bulletSpeed:700,tornadosRotationSpeed:.05,tornadosCount:6,checkScope:100,petFireSpeed:500,petFireDis:100,petFireCount:5,petFireCreateDis:1e3,knifeCount:6,knifeCreateDis:500,knifeSpeed:200,curvature:.1},this.isDead=!1,this.maxLife=10,this.life=10,this.fireTime=(new Date).getTime(),this.petFireTime=(new Date).getTime(),this.petFireCreateTime=(new Date).getTime(),this.knifeCreateTime=(new Date).getTime(),this.isPetFire=!0,this.petFireCount=0,this.init()}return _createClass(e,[{key:"init",value:function(){this.initPlayer(),this.initVirtualJoystick()}},{key:"initPlayer",value:function(){this.player=game.add.sprite(game.world.centerX,game.world.centerY,keyMap.player),game.physics.arcade.enable(this.player,Phaser.Physics.ARCADE),this.player.body.setSize(this.player.width,this.player.height),this.player.scale.set(.7,.7),this.player.body.immovable=!0,this.player.body.collideWorldBounds=!0,this.player.anchor.set(.5,.5);var e=game.add.tween(this.player).to({height:this.player.height/1.2,width:1.2*this.player.width},500,Phaser.Easing.Sinusoidal.Out,!0);e.yoyo(!0),e.repeat(),this.animations=this.player.animations,this.animations.add("left",[0],5,!0),this.animations.add("right",[1],5,!0),this.animations.frame=4,this.bullets=game.add.group(),this.bullets.enableBody=!0,this.blood=game.add.graphics(),this.player.addChild(this.blood),this.drawBlood(this.player.width),this.KnifeGroup=game.add.group(),this.KnifeGroup.enableBody=!0,this.isDead=!1,this.fireKnife()}},{key:"initVirtualJoystick",value:function(){this.pad=game.plugins.add(Phaser.VirtualJoystick),this.stick=this.pad.addStick(game.world.centerX,game.world.centerY+250,200,keyMap.joystick),this.stick.scale=scaleAdaptation(247)}},{key:"run",value:function(){this.stick.isDown?0<game.physics.arcade.velocityFromRotation(this.stick.rotation,this.stick.force*this.config.moveSpeed,this.player.body.velocity).x?(this.pet.frame=1,this.animations.play("right"),this.player.direction="right"):(this.pet.frame=0,this.animations.play("left"),this.player.direction="left"):this.stop()}},{key:"stop",value:function(){this.animations.stop(),this.player.body.velocity.set(0)}},{key:"fire",value:function(e){var t,i,o=this;this.isDead||(t=this.player.direction,(new Date).getTime()-this.fireTime>this.config.bulletDis&&((i=this.bullets.getFirstExists(!1))||((i=this.bullets.create(this.player.x,this.player.y,keyMap.gun)).scale.set(.5,.5),i.anchor.set(.5,.5),i.body.setSize(i.width,i.height)),i.reset(this.player.x,this.player.y),i.checkWorldBounds=!0,i.outOfBoundsKill=!0,i.vector=null,"right"===t?(i.direction="right",i.rotation=3.14):(i.rotation=0,i.direction="left"),e&&(i.vector=computeVector(e.position.x,e.position.y,i.position.x,i.position.y),i.rotation=computeRotation(e.position.x,e.position.y,i.position.x,i.position.y)+Math.PI),this.fireTime=(new Date).getTime()),this.bullets.length&&this.bullets.forEachAlive(function(e){e.vector?(e.body.velocity.x=e.vector.x*o.config.bulletSpeed,e.body.velocity.y=e.vector.y*o.config.bulletSpeed):"left"===e.direction?e.body.velocity.x=-o.config.bulletSpeed:e.body.velocity.x=o.config.bulletSpeed}))}},{key:"dead",value:function(){this.player.kill(),this.isDead=!0}},{key:"injury",value:function(){--this.life;var e=this.life/this.maxLife*this.player.width;this.drawBlood(e)}},{key:"addTornadoSkill",value:function(){this.tornadoColliders=[],this.tornadoColliders.enableBody=!0,this.tornados=game.add.group(),this.tornados.enableBody=!0,this.tornados.pivot.x=this.player.x,this.tornados.pivot.y=this.player.y;for(var e=2*Math.PI/this.config.tornadosCount,t=rem2px(2),i=0;i<this.config.tornadosCount;i++){var o=game.add.spine(this.player.x,this.player.y,keyMap.tornado);this.tornados.add(o),o.setAnimationByName(0,keyMap.tornadoRotation,!0),o.scale.set(.05,.05),console.log(o);var s=this.player.x+Math.sin(e*i)*t,a=this.player.y+Math.cos(e*i)*t;console.log(collider),this.tornadoColliders.push(collider),o.addChild(collider);game.add.tween(o).to({x:s,y:a},1e3,Phaser.Easing.Sinusoidal.Out,!0)}}},{key:"tornadosRotate",value:function(){var t=this;this.tornados&&!this.tornados.stop&&(this.tornados.x=this.player.x,this.tornados.y=this.player.y,this.tornados.rotation+=this.config.tornadosRotationSpeed,this.tornados.forEachAlive(function(e){e.rotation-=t.config.tornadosRotationSpeed,0}))}},{key:"stopTornadosRotate",value:function(){this.tornados.stop=!0}},{key:"addPet",value:function(){this.pet=game.add.image(-this.player.width/2-10,-this.player.height/2-10,keyMap.pet),this.pet.anchor.set(.5,.5),this.pet.scale.set(.2,.2),this.pet.fireGroup=game.add.group(),this.pet.fireGroup.enableBody=!0;var e=game.add.tween(this.pet).to({y:this.pet.world.y-20},1e3,Phaser.Easing.Linear.In,!0);e.yoyo(!0),e.repeat(),this.player.addChild(this.pet)}},{key:"petFire",value:function(){var e,t,i=(new Date).getTime()-this.petFireTime,o=this.player.direction;!this.isPetFire&&(new Date).getTime()-this.petFireCreateTime>this.config.petFireCreateDis&&(this.isPetFire=!0,this.petFireCreateTime=(new Date).getTime()),this.isPetFire&&i>this.config.petFireDis&&(e=this.pet.fireGroup.getFirstExists(!1),t=(2*Math.PI/this.config.petFireCount*this.petFireCount).toFixed(2),e||((e=this.pet.fireGroup.create(0,0,keyMap.fireBall)).animations.add("mover",[0,1,2,3,4],10,!0),e.animations.play("mover"),e.scale.set(.5,.5),e.anchor.set(.5,.5),e.body.setSize(e.width,e.height)),e.anchor.set(.5,.5),e.vector={angle:t,x:+Math.sin(t),y:+Math.cos(t)},e.reset(this.pet.world.x+this.pet.width/2,this.pet.world.y+this.pet.height/2),this.petFireTime=(new Date).getTime(),e.rotation=0==t?Math.PI/2:2*Math.PI/this.config.petFireCount*(1-this.petFireCount),e.body.velocity.x=e.vector.x*this.config.petFireSpeed,e.body.velocity.y=e.vector.y*this.config.petFireSpeed,e.checkWorldBounds=!0,e.outOfBoundsKill=!0,e.direction="right"===o?"right":"left",this.petFireCount+=1,this.petFireCount>=this.config.petFireCount&&(this.isPetFire=!1,this.petFireCount=0))}},{key:"fireKnife",value:function(){(new Date).getTime(),this.knifeCreateTime;for(var e=Math.PI/this.config.knifeCount,t=0;t<3;t++){console.log("ðŸš€ ~ file: player.js ~ line 392 ~ rotation",e*t);var i=this.KnifeGroup.getFirstExists(!1);console.log("ðŸš€ ~ file: player.js ~ line 394 ~ knife",i),i||((i=this.KnifeGroup.create(this.player.x,this.player.y,keyMap.knife)).scale.set(.2,.2),i.animations.add("rotation",[0,1,2,3,4],45,!0),i.animations.play("rotation"),i.checkWorldBounds=!0,i.outOfBoundsKill=!0,i.checkWorldBounds=!0,i.outOfBoundsKill=!0),i.body.velocity.x=Math.asin(e*t)*this.config.knifeSpeed,i.body.velocity.y=Math.acos(e*t)*this.config.knifeSpeed}this.knifeCreateTime=(new Date).getTime(),this.config.knifeCreateDis}},{key:"drawBlood",value:function(e){var t=-this.player.width/2,i=this.player.height/2+10,o=16777215;this.blood.clear(),this.blood.beginFill(65280,1),this.blood.lineStyle(0),this.blood.drawRect(t,i,e,8),this.blood.lineStyle(2,o,1),this.blood.moveTo(t,i),this.blood.lineTo(t+this.player.width,i),this.blood.lineStyle(2,o,1),this.blood.moveTo(t+this.player.width,i),this.blood.lineTo(t+this.player.width,8+i),this.blood.lineStyle(2,o,1),this.blood.moveTo(t+this.player.width,8+i),this.blood.lineTo(t,8+i),this.blood.lineStyle(2,o,1),this.blood.moveTo(t,8+i),this.blood.lineTo(t,i),this.blood.endFill()}}]),e}();