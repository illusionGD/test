"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}var EnemyFactory=function(){function e(){_classCallCheck(this,e),this.config={moveSpeed:100,createDis:500,createNum:1,maxCount:100,life:1,juryTime:500,deadTime:200},this.lasTime=(new Date).getTime(),this.init()}return _createClass(e,[{key:"init",value:function(){this.isDead=!1,this.enemyGroup=game.add.group(),this.enemyGroup.enableBody=!0}},{key:"move",value:function(e,t){var a=this,o=0<arguments.length&&void 0!==e?e:0,r=1<arguments.length&&void 0!==t?t:0;this.enemyGroup.forEachAlive(function(e){var t=computeVector(o,r,e.x,e.y),i=t.x,n=t.y;e.isDead?(e.body.velocity.x=i/2*-a.config.moveSpeed,e.body.velocity.y=0):(e.body.velocity.x=i*a.config.moveSpeed,e.body.velocity.y=n*a.config.moveSpeed,e.frame=0<i?2:1)})}},{key:"createEnemy",value:function(e,t){var n=this;if((new Date).getTime()-this.lasTime>this.config.createDis&&this.config.maxCount>this.enemyGroup.total){for(var a=e+rem2px(1),o=e-rem2px(1),r=t+rem2px(1),s=t-rem2px(1),i=0;i<this.config.createNum;i++)!function(){var e=game.camera.position.x-game.camera.width/2+Math.random()*game.camera.width,t=game.camera.position.y-game.camera.height/2+Math.random()*game.camera.height,i=n.enemyGroup.getFirstExists(!1);e<a&&o<e&&(e=a),t<r&&s<t&&(t=s),i||((i=n.enemyGroup.create(e,t,keyMap.enemy)).scale.set(.6,.6),i.anchor.set(.5,1),i.body.setSize(i.width,i.height),i.shakeTween=game.add.tween(i).to({rotation:.2},1e3,Phaser.Easing.Cubic.In,!0,0,-1,!0),i.DeadTween=game.add.tween(i).to({},n.config.deadTime,Phaser.Easing.Cubic.In,!1),i.DeadTween.onComplete.add(function(){i.kill()}),i.DeadTween.onStart.add(function(){i.isDead=!0,i.shakeTween.stop(),i.tint=16777215,i.frame=1===i.frame?0:3}),i.inJuryTween=game.add.tween(i).to({},n.config.juryTime,Phaser.Easing.Cubic.In,!1),i.inJuryTween.onComplete.add(function(){i.isJury=!1,i.tint=16777215}),i.inJuryTween.onStart.add(function(){i.isJury=!0,i.tint=14423100}),i.body.collideWorldBounds=!0),i.life=n.config.life,n.resetEnemy(i,e,t)}();this.lasTime=(new Date).getTime()}}},{key:"resetEnemy",value:function(e,t,i){e.isDead=!1,e.isJury=!1,e.shakeTween.start(),e.frame=1,e.tint=16777215,e.reset(t,i)}},{key:"stop",value:function(){this.enemyGroup.forEachAlive(function(e){e.body.velocity.set(0),e.shakeTween.pause()})}},{key:"start",value:function(){this.enemyGroup.forEachAlive(function(e){e.shakeTween.start()})}}]),e}();