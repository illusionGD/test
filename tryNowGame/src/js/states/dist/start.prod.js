"use strict";var gameStartState=function(){var n,a,i,t,r,s=30,o=!1,l=0,e=!1,c=[],m=5;function d(e,t){t.kill(),u(e)}function p(e,t){t.isDead||t.isJury||(n.injury(),u(t))}function u(e){--e.life,0<e.life?e.inJuryTween.start():e.isDead||e.isJury||(e.DeadTween.start(),l+=1,c.length<3&&m<=l&&(f(),document.querySelector(".skill-pop").style.display="flex",l=0))}function y(){if(0===s)return game.time.events.remove(i),void(o=!0);var e=game.time.totalElapsedSeconds().toFixed(0);e<10&&(enemies.config.createNum=e||1),20===s&&(enemies.config.createNum=10,enemies.config.life=2),10===s&&(enemies.config.moveSpeed=300,enemies.config.life=3);var t=10<=s-1?--s:"0"+--s;a.text="00:".concat(t)}function f(){n.stop(),enemies.stop(),i.timer.paused=!0,e=!0}function g(e){return c.includes(e)}function h(){document.querySelector(".pop").style.display="none",n.start(),enemies.start(),i.timer.paused=!1,e=!1}this.create=function(){game.add.tileSprite(0,0,1920,1920,keyMap.startBgImg),game.physics.startSystem(Phaser.Physics.ARCADE),n=new Player,game.camera.follow(n.player),game.world.setBounds(0,0,rem2px(19.2),rem2px(19.2)),enemies=new EnemyFactory,enemies.init(),(t=game.add.image(0,0,keyMap.topTimeBg)).fixedToCamera=!0;var e=scaleAdaptation(750);t.scale.set(e,e),i=game.time.events.repeat(+Phaser.Timer.SECOND,s+1,y,this),(a=game.add.text(game.camera.width/2,rem2px(1.05),"00:".concat(s),{font:"bold ".concat(rem2px(.4),"px Arial"),fill:"#fff"})).stroke="#000",a.strokeThickness=5,a.fixedToCamera=!0,a.anchor.set(.5,.5),(r=game.add.text(game.camera.width/2,rem2px(1.05),"怪物数:".concat(enemies.enemyGroup.length),{font:"bold ".concat(rem2px(.4),"px Arial"),fill:"#fff"})).fixedToCamera=!0},this.update=function(){if(!e){if(o||n.life<=0)return o=!0,f(),void(document.querySelector(".award-pop").style.display="block");n.run();var a=null,i=game.camera.width;enemies.enemyGroup.forEachAlive(function(e){var t;e.isDead||(t=game.physics.arcade.distanceToPointer(n.player,e.pointer))<i&&(i=t,a=e)}),n.fire(a),n.fireKnife(),n.petFire(),n.tornadosRotate(),enemies.move(n.player.x,n.player.y),enemies.createEnemy(n.player.x,n.player.y),game.physics.arcade.overlap(enemies.enemyGroup,n.bullets,d,null,this),game.physics.arcade.overlap(enemies.enemyGroup,n.player,p,null,this),game.physics.arcade.overlap(enemies.enemyGroup,n.tornados,u,null,this),game.physics.arcade.overlap(enemies.enemyGroup,n.pet.fireGroup,u,null,this),game.physics.arcade.overlap(enemies.enemyGroup,n.KnifeGroup,u,null,this)}},this.render=function(){r.text="怪物数:".concat(enemies.enemyGroup.length)},document.querySelector(".btn-skill1").addEventListener("click",function(e){g("1")||(c.push("1"),e.target.classList.add("btn-skill-gray"),n.addTornadoSkill(),h())}),document.querySelector(".btn-skill2").addEventListener("click",function(e){g("2")||(c.push("2"),e.target.classList.add("btn-skill-gray"),n.stopKnife=!1,h())}),document.querySelector(".btn-skill3").addEventListener("click",function(e){g("3")||(c.push("3"),e.target.classList.add("btn-skill-gray"),n.pet.visible=!0,n.stopPetFire=!1,h())}),document.querySelector(".btn-reward").addEventListener("click",function(e){e.stopPropagation()})};