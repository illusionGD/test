"use strict";var gameStartState=function(){var i,a,n,t,r,s=30,o=!1,l=0,e=!1,c=[],m=5;function d(e,t){t.kill(),u(e)}function p(e,t){t.isDead||t.isJury||(i.injury(),u(t))}function u(e){--e.life,0<e.life?e.inJuryTween.start():e.isDead||e.isJury||(e.DeadTween.start(),l+=1,c.length<3&&m<=l&&(f(),document.querySelector(".skill-pop").style.display="flex",l=0))}function y(){if(0===s)return game.time.events.remove(n),void(o=!0);var e=game.time.totalElapsedSeconds().toFixed(0);enemies.config.createNum=e||1,20===s&&(enemies.config.moveSpeed=100,enemies.config.life=2);var t=10<=s-1?--s:"0"+--s;a.text="00:".concat(t)}function f(){i.stop(),enemies.stop(),n.timer.paused=!0,e=!0}function g(e){return c.includes(e)}function h(){document.querySelector(".pop").style.display="none",i.start(),enemies.start(),n.timer.paused=!1,e=!1}this.create=function(){game.add.tileSprite(0,0,1920,1920,keyMap.startBgImg),game.physics.startSystem(Phaser.Physics.ARCADE),i=new Player,game.camera.follow(i.player),game.world.setBounds(0,0,rem2px(19.2),rem2px(19.2)),enemies=new EnemyFactory,enemies.init(),(t=game.add.image(0,0,keyMap.topTimeBg)).fixedToCamera=!0;var e=scaleAdaptation(750);t.scale.set(e,e),n=game.time.events.repeat(+Phaser.Timer.SECOND,s+1,y,this),(a=game.add.text(game.camera.width/2,rem2px(1.05),"00:".concat(s),{font:"bold ".concat(rem2px(.4),"px Arial"),fill:"#fff"})).stroke="#000",a.strokeThickness=5,a.fixedToCamera=!0,a.anchor.set(.5,.5),(r=game.add.text(0,rem2px(1.1),"怪物数:".concat(enemies.enemyGroup.length,"\n生命值: ").concat(i.life),{font:"bold ".concat(rem2px(.4),"px Arial"),fill:"#fff"})).fixedToCamera=!0},this.update=function(){if(!e){if(o||i.life<=0)return o=!0,f(),void(document.querySelector(".award-pop").style.display="block");i.run();var a=null,n=game.camera.width;enemies.enemyGroup.forEachAlive(function(e){var t;e.isDead||(t=game.physics.arcade.distanceToPointer(i.player,e.pointer))<n&&(n=t,a=e)}),i.fire(a),i.fireKnife(),i.petFire(),i.tornadosRotate(),enemies.move(i.player.x,i.player.y),enemies.createEnemy(i.player.x,i.player.y),game.physics.arcade.overlap(enemies.enemyGroup,i.bullets,d,null,this),game.physics.arcade.overlap(enemies.enemyGroup,i.player,p,null,this),game.physics.arcade.overlap(enemies.enemyGroup,i.tornados,u,null,this),game.physics.arcade.overlap(enemies.enemyGroup,i.pet.fireGroup,u,null,this),game.physics.arcade.overlap(enemies.enemyGroup,i.KnifeGroup,u,null,this)}},this.render=function(){r.text="怪物数:".concat(enemies.enemyGroup.length,"\n生命值: ").concat(i.life)},document.querySelector(".btn-skill1").addEventListener("click",function(e){g("1")||(c.push("1"),e.target.classList.add("btn-skill-gray"),i.addTornadoSkill(),h())}),document.querySelector(".btn-skill2").addEventListener("click",function(e){g("2")||(c.push("2"),e.target.classList.add("btn-skill-gray"),i.stopKnife=!1,h())}),document.querySelector(".btn-skill3").addEventListener("click",function(e){g("3")||(c.push("3"),e.target.classList.add("btn-skill-gray"),i.pet.visible=!0,i.stopPetFire=!1,h())}),document.querySelector(".btn-reward").addEventListener("click",function(e){e.stopPropagation()})};