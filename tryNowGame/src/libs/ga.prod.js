"use strict";function ownKeys(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(n,!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(n).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(){var e,u=(_defineProperty(e={userInfo:{},gaTrackId:"",gameCode:"",activitycode:"",tbName:"web_user_action"},"userInfo",{}),_defineProperty(e,"device",""),_defineProperty(e,"version","1.0"),_defineProperty(e,"heartBeatUrl","https://apm.efun.com/apm/heartbeat"),_defineProperty(e,"abtName","origin"),_defineProperty(e,"CLIENT_ID_COOKIE_EXPIRE",7776e6),_defineProperty(e,"SESSION_ID_KEY",""),_defineProperty(e,"CLIENT_ID_KEY",""),_defineProperty(e,"isInsertGtagJs",!0),_defineProperty(e,"gtmElementOptions",{options:{},list:[]}),_defineProperty(e,"isHeartBeat",!1),_defineProperty(e,"isSendGA",!0),_defineProperty(e,"init",function(e){var t=e.gaId,n=e.gameCode,r=e.activityCode,o=e.activityTimes,i=e.gtmElementOptions,a=e.abtName,c=e.isInsertGtagJs;if(!t||!n||!r)throw new Error("gaId and gameCode and activityCode is required");u.startTime=(new Date).getTime(),u.gaTrackId=t||"",u.activitycode=r||"",u.gameCode=n,u.abtName=a||window.abTestName||u.abtName,u.isInsertGtagJs=!!u.isInvalidVal(c)||c,u.CLIENT_ID_COOKIE_EXPIRE=o||u.CLIENT_ID_COOKIE_EXPIRE,u.SESSION_ID_KEY="_efe_sid_"+u.gameCode+"_"+u.activitycode,u.CLIENT_ID_KEY="_efe_cid_"+u.gameCode+"_"+u.activitycode,u.gtmElementOptions=Object.assign(u.gtmElementOptions,i),u.clientTag=u.getClientTag(),u.initHtmlHead(),u.bindEvent(),u.device=u.getLocalStorage("device"),u.device||(u.device=u.getUUid(),u.setLocalStorage("device",u.device)),u.setSessionStorage(u.SESSION_ID_KEY,u.getUUid()),u.sendPageViewEvent(),u.initSetCookieInfo()}),_defineProperty(e,"initHtmlHead",function(){var e,t,n=document.getElementsByTagName("head")[0];u.isInsertGtagJs&&(e=document.createElement("script"),(t=document.createElement("script")).async=!0,e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id="+u.gaTrackId,t.src="https://www.google-analytics.com/analytics.js",n.appendChild(e));var r=document.createElement("script");r.innerHTML="\n                        window.dataLayer = window.dataLayer || []\n                        function gtag() {\n                            dataLayer.push(arguments)\n                        }\n                        gtag('js', new Date())\n                        gtag('config', '".concat(u.gaTrackId,"')\n                    "),n.appendChild(r)}),_defineProperty(e,"initSetCookieInfo",function(){u.CLIENT_ID_KEY&&u.resetClientIdExpire(u.CLIENT_ID_KEY,u.device,u.CLIENT_ID_COOKIE_EXPIRE)}),_defineProperty(e,"initGTMVisibleElement",function(e){var t,n;e&&e.list&&e.list.length&&(t=e.list,n=Object.assign({root:null,rootMargin:"0px",threshold:[.5,.75,1]},e.options),u.observer=new IntersectionObserver(function(e){e.forEach(function(e){var t,n,r,o,i,a=e.isIntersecting,c=e.target;a&&(u.observer.unobserve(c),n=(t=c.trackerInfo).action,r=t.type,o=t.label,i=u.getHeartBeatData(r,n,o,{event_type:"view"}),u.heartbeat([i]))})},n),t.forEach(function(e){var t=e.action,n=e.type,r=e.label,o=e.selector,i=document.querySelector(o);i.trackerInfo={action:t,type:n,label:r},u.observer.observe(i)}))}),_defineProperty(e,"sendPageViewEvent",function(){var e=u.getHeartBeatData("pageView","pageView","",{event_type:"auto"});u.heartbeat([e])}),_defineProperty(e,"sendTrackEvent",function(e,t,n,r){var o=1<arguments.length&&void 0!==t?t:"点击",i=2<arguments.length?n:void 0,a=3<arguments.length?r:void 0;u.isSendGA&&u.sendToGoogleAnalytics(e,o,i,a);var c=u.getHeartBeatData(e,o,i,{event_type:"action"});u.heartbeat([c])}),_defineProperty(e,"bindEvent",function(){window.addEventListener("load",function(){var e=u.filterObject(u.getPerformanceTime("all"),function(e,t){return"stop_time"!==e}),t=u.getHeartBeatData("性能监控","性能监控","",{event_type:"auto"},e);u.heartbeat([t]),u.initGTMVisibleElement(u.gtmElementOptions)}),window.addEventListener("beforeunload",function(e){var t={stop_time:u.getPerformanceTime("stop")},n=u.getHeartBeatData("页面跳出","页面跳出","",{event_type:"auto"},t);u.heartbeat([n])})}),_defineProperty(e,"sendToGoogleAnalytics",function(e,t,n,r){gtag?gtag("event",t,{event_category:e,event_label:n||t,event_callback:function(){u.gaCallback(r)}}):gaCallback(r)}),_defineProperty(e,"gaCallback",function(e){e&&"function"!=typeof e?location.href=e:e&&e()}),_defineProperty(e,"heartbeat",function(e){var r=0<arguments.length&&void 0!==e?e:[];if(!u.isHeartBeat&&r.length){if(!u.gameCode||!u.activitycode)throw new Error("gaId and gameCode and activityCode is required");return new Promise(function(t,n){var e;r instanceof Array?(e={url:u.heartBeatUrl,method:"post",heads:{"content-type":"application/json",game:u.gameCode,device:u.device},data:{version:u.version,datas:r}},u.ajax(e).then(function(e){t(e)}).catch(function(e){n(e)})):console.log("datas is not array")})}}),_defineProperty(e,"getHeartBeatData",function(e,t,n,r,o){var i,a=3<arguments.length&&void 0!==r?r:{},c=4<arguments.length&&void 0!==o?o:{},s=_objectSpread({},u.getBaseTags(t),{action_category:e,label:n||t},a),d=_objectSpread({},u.getBaseFields(),{},c),f=u.transformObjKeyToLow(s),g=u.filterObject(u.transformObjKeyToLow(d),function(e,t){return!u.isInvalidVal(t)});return g.url||(g.url=window.href),g.session_id||(i=u.getSessionStorage(u.SESSION_ID_KEY)||u.getUUid(),g.session_id=i,u.setSessionStorage(u.SESSION_ID_KEY,i)),{tb:u.tbName,logtime:u.millisecondToSecond((new Date).getTime()),msgid:u.formatUUidTo32(u.getUUid()),tags:f,fields:g}}),_defineProperty(e,"getPerformanceObj",function(){return{load_time:u.getPerformanceTime("load"),dns_time:u.getPerformanceTime("dns"),tcp_time:u.getPerformanceTime("tcp"),request_time:u.getPerformanceTime("request"),redirect_time:u.getPerformanceTime("redirect"),response_time:u.getPerformanceTime("response")}}),_defineProperty(e,"getPerformanceTime",function(e){var t=window.performance;if(t)return t.getEntries?u.getTimesByNavigationTiming(e):t.timing?u.getTimesByTiming(e):void 0;console.log("performance no support")}),_defineProperty(e,"getTimesByTiming",function(e){var t=performance.timing,n=0,r={white:function(){n=t.responseEnd-t.requestStart},load:function(){n=t.loadEventStart-t.navigationStart},stop:function(){n=performance.now()},redirect:function(){n=t.redirectEnd-t.redirectStart},dns:function(){n=t.domainLookupEnd-t.domainLookupStart},tcp:function(){n=t.connectEnd-t.connectStart},request:function(){n=t.responseStart-t.requestStart},response:function(){n=t.responseEnd-t.responseStart}};if("all"!==e)return r[e](),Math.ceil(n);var o={};for(var i in r)o["".concat(i,"_time")]=r[i]();return o}),_defineProperty(e,"getTimesByNavigationTiming",function(e){var t=performance.getEntries()[0],n=0,r={white:function(){n=t.responseEnd-t.requestStart},load:function(){n=t.loadEventStart-t.startTime},stop:function(){n=performance.now()},redirect:function(){n=t.redirectEnd-t.redirectStart},dns:function(){n=t.domainLookupEnd-t.domainLookupStart},tcp:function(){n=t.connectEnd-t.connectStart},request:function(){n=t.responseStart-t.requestStart},response:function(){n=t.responseEnd-t.responseStart}};if("all"!==e)return r[e](),Math.round(n);var o={};for(var i in r)r[i](),o["".concat(i,"_time")]=Math.round(n);return o}),_defineProperty(e,"getBaseFields",function(){var e=u.getUserInfo(),t=e.userid,n=e.phone;return{url:window.location.href,client_id:u.device,phone:n,session_id:u.getSessionStorage(u.SESSION_ID_KEY),userid:t}}),_defineProperty(e,"getBaseTags",function(e){var t=document.querySelector("head title").innerHTML;return _objectSpread({page_id:u.gaTrackId,gamecode:u.gameCode,action:e||"点击",activitycode:u.activitycode,web_title:t,event_type:"",abt_name:u.abtName||"",client_tag:u.clientTag},u.getAdvertInfo(),{},u.getUserAgentInfo())}),_defineProperty(e,"getUserInfo",function(){return{timestamp:u.getCookie("timestamp")||u.getCookie("loginTimestamp"),userid:u.getCookie("userId")||u.getCookie("efunUserid")||"",phone:u.getCookie("phone")||""}}),_defineProperty(e,"getAdvertInfo",function(){var e=u.getQueryString("utm_source"),t=u.getQueryString("utm_medium"),n=u.getQueryString("utm_campaign");return{advertiser:e||"",adsid:t||n?t+"_"+n:"",campaign_name:u.getQueryString("campaign_name")||"",adgroup_name:u.getQueryString("adgroup_name")||"",ad_name:u.getQueryString("ad_name")||""}}),_defineProperty(e,"getClientTag",function(){return u.getCookie(u.CLIENT_ID_KEY)?"old":"new"}),_defineProperty(e,"setActivityTimes",function(e){var t=parseInt(e);u.CLIENT_ID_COOKIE_EXPIRE=t||u.CLIENT_ID_COOKIE_EXPIRE,u.resetClientIdExpire()}),_defineProperty(e,"resetClientIdExpire",function(){var e=u.CLIENT_ID_KEY,t=u.getCookie(e)||u.device||u.getUUid();u.setCookie(e,t,u.CLIENT_ID_COOKIE_EXPIRE)}),_defineProperty(e,"getUserAgentInfo",function(){if(!window.UAParser)throw new Error("please introduce ua-parser.min.js");var e=UAParser(),t=e.browser,n=e.device,r=e.engine,o=e.os,i="iOS"===o.name||"Mac OS"===o.name?"ios":"android",a=n.model?n.model+"#"+n.vendor+"#"+n.type:"pc";return{browser:t.name+"#"+t.version,device_model:a,browser_engine:r.name+"#"+r.version,os:o.name+"#"+o.version,plat:i}}),_defineProperty(e,"transformObjKeyToLow",function(e){if(e instanceof Object){var t={};for(var n in e){var r=u.humpToLine(n),o=e[n];t[r]=o}return t}return e}),_defineProperty(e,"getUUid",function(){var n=(new Date).getTime();return window.performance&&"function"==typeof window.performance.now&&(n+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(n+16*Math.random())%16|0;return n=Math.floor(n/16),("x"===e?t:3&t|8).toString(16)})}),_defineProperty(e,"formatUUidTo32",function(e){if(32<e.length){var t=e.split("-");return t.slice(0,4).join("")+"-"+t[t.length-1]}}),_defineProperty(e,"isInvalidVal",function(e){return["",null,void 0,"null","undefined",NaN,"NaN"].includes(e)}),_defineProperty(e,"millisecondToSecond",function(e){return Math.ceil(Number(e)/1e3)}),_defineProperty(e,"getQueryString",function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),n=window.location.search.slice(1).match(t);return null!=n?decodeURIComponent(n[2]):""}),_defineProperty(e,"getCookie",function(e){for(var t=document.cookie.split(";"),n=0;n<t.length;n++){var r=t[n].split("=");if(r[0].trim()===e)return r[1]}return""}),_defineProperty(e,"setCookie",function(e,t,n){var r,o,i=2<arguments.length&&void 0!==n?n:288e5,a=e+"="+t;0<i&&(o=i,(r=new Date).setTime(r.getTime()+o),a+="; expires="+r.toUTCString()),a+="; path=/",document.cookie=a}),_defineProperty(e,"getUrlParams",function(){var e,t=window.location.search.substring(1)||"",o={};return!t||(e=t.split("&")).length&&e.forEach(function(e){var t=e.split("="),n=t[0],r=t[1];o[n]=r}),o}),_defineProperty(e,"getLocalStorage",function(e){return JSON.parse(localStorage.getItem(e))}),_defineProperty(e,"setLocalStorage",function(e,t){localStorage.setItem(e,JSON.stringify(t))}),_defineProperty(e,"getSessionStorage",function(e){return JSON.parse(sessionStorage.getItem(e))}),_defineProperty(e,"setSessionStorage",function(e,t){sessionStorage.setItem(e,JSON.stringify(t))}),_defineProperty(e,"filterObject",function(e,t){var n={};for(var r in e)t(r,e[r])&&(n[r]=e[r]);return n}),_defineProperty(e,"humpToLine",function(e){return e?e.slice(0,1).toLowerCase()+e.slice(1).replace(/([A-Z])/g,"_$1").toLowerCase():""}),_defineProperty(e,"ajax",function(e){var c,s=e.url,d=e.method.toLocaleLowerCase()||"get",f=0!=e.async,g=e.data,u=e.heads;return window.XMLHttpRequest?c=new XMLHttpRequest:window.ActiveObject&&(c=new ActiveXobject("Microsoft.XMLHTTP")),e.timeout&&0<e.timeout&&(c.timeout=e.timeout),new Promise(function(t,n){c.ontimeout=function(){return n&&n("请求超时")},c.onreadystatechange=function(){var e;4==c.readyState&&(200<=c.status&&c.status<300||304==c.status?(e=JSON.parse(c.responseText)).error?console.log(e.error):t&&t(e):(n&&n("请求失败"),console.log("接口连接失败")))},c.onerror=function(e){return n&&n(e)};var e,r=[];if("get"===d){if(g instanceof Object){for(var o in g)r.push(o+"="+g[o]);e=r.join("&")}var i=s.indexOf("?");-1===i?s+="?":i!==s.length-1&&(s+="&"),s+=e}if(c.open(d,s,f),"get"===d)c.send(null);else{if(u instanceof Object)for(var a in u)c.setRequestHeader(a,u[a]);c.send(JSON.stringify(g))}})}),e);window.tracker=u,window.sendTrackEvent=u.sendTrackEvent}(window);